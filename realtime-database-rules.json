{
  "rules": {
    "chats": {
      "$coupleId": {
        ".read": "auth != null && (
          root.child('couples').child($coupleId).child('user1Id').val() == auth.uid ||
          root.child('couples').child($coupleId).child('user2Id').val() == auth.uid
        )",
        ".write": "auth != null && (
          root.child('couples').child($coupleId).child('user1Id').val() == auth.uid ||
          root.child('couples').child($coupleId).child('user2Id').val() == auth.uid
        )",
        "$messageId": {
          ".validate": "newData.hasChildren(['senderId', 'message', 'timestamp'])",
          "senderId": {
            ".validate": "newData.val() == auth.uid"
          },
          "message": {
            ".validate": "newData.isString() && newData.val().length > 0 && newData.val().length <= 1000"
          },
          "timestamp": {
            ".validate": "newData.val() == now"
          }
        }
      }
    },
    "games": {
      "$coupleId": {
        ".read": "auth != null && (
          root.child('couples').child($coupleId).child('user1Id').val() == auth.uid ||
          root.child('couples').child($coupleId).child('user2Id').val() == auth.uid
        )",
        ".write": "auth != null && (
          root.child('couples').child($coupleId).child('user1Id').val() == auth.uid ||
          root.child('couples').child($coupleId).child('user2Id').val() == auth.uid
        )",
        "$sessionId": {
          ".validate": "newData.hasChildren(['gameType', 'state', 'scores'])",
          "gameType": {
            ".validate": "newData.isString()"
          },
          "state": {
            ".validate": "newData.exists()"
          },
          "scores": {
            ".validate": "newData.exists()"
          }
        }
      }
    },
    "couples": {
      "$coupleId": {
        ".read": "auth != null && (
          data.child('user1Id').val() == auth.uid ||
          data.child('user2Id').val() == auth.uid
        )",
        ".write": "auth != null && (
          data.child('user1Id').val() == auth.uid ||
          data.child('user2Id').val() == auth.uid
        )"
      }
    }
  }
}

